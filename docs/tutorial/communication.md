# フロントエンドとバックエンドの通信

フロントエンド（Flutter）とバックエンド（Golang）は、以下の通信プロトコルを使用してデータをやり取りします。

### HTTP/3 (QUIC)
- 主にRESTful APIのエンドポイントを通じてデータを取得・送信します。
- 高速で信頼性の高い通信を実現します。
- HTTP/2と比較して、接続の確立が迅速で、ヘッドオブラインブロッキングが発生しません。
- QUICはUDPを基盤としており、パケットロスに対する耐性が高いです。
- **具体例**: ユーザーのプロフィール情報を取得する際にHTTP/3を使用して高速にデータを取得します。

### WebSocket
- リアルタイム通信が必要な場合に使用します。
- 例：チャットアプリケーションやリアルタイム通知。
- 双方向通信をサポートし、低レイテンシでメッセージを送受信できます。
- WebSocketは、HTTPハンドシェイクを使用して接続を確立し、その後はTCP接続を維持します。
- **具体例**: チャットアプリケーションで新しいメッセージが送信されると、即座に他のユーザーに通知されます。

### gRPC
- 高性能なRPC（Remote Procedure Call）を実現します。
- バイナリプロトコルを使用するため、効率的なデータ転送が可能です。
- HTTP/2を基盤としており、ストリーミングや双方向通信をサポートします。
- gRPCは、プロトコルバッファをデフォルトのインターフェース記述言語として使用します。
- **具体例**: マイクロサービス間でのデータ処理や、複雑な計算処理を分散して実行する際に使用します。

### 認証と認可
- フロントエンドからバックエンドへのリクエストは、JWT（JSON Web Token）を使用して認証されます。
- 各リクエストには適切な認可が必要です。
- JWTは、ユーザーの認証情報を安全に伝達するための標準です。
- JWTの有効期限とリフレッシュトークンの管理が重要です。
- **具体例**: ユーザーがログインすると、JWTが発行され、以降のリクエストに含めて認証を行います。

### エラーハンドリング
- フロントエンドは、バックエンドからのエラーレスポンスを適切に処理します。
- 共通のエラーハンドリングメカニズムを実装します。
- エラーコードとメッセージを標準化し、ユーザーに適切なフィードバックを提供します。
- 例外処理を適切に行い、予期しないエラーをキャッチします。
- **具体例**: APIリクエストが失敗した場合、ユーザーに「ネットワークエラーが発生しました」と通知します。

### データフォーマット
- データはJSON形式で送受信されます。
- 必要に応じて、プロトコルバッファ（Protocol Buffers）を使用してデータをシリアライズします。
- JSONは人間が読みやすく、デバッグが容易です。
- プロトコルバッファは、バイナリ形式で効率的なデータ転送を可能にします。
- プロトコルバッファは、スキーマを使用してデータ構造を定義します。

#### JSONの使用ケース
- RESTful APIのエンドポイントでのデータ送受信。
- フロントエンドとバックエンド間の一般的なデータ交換。
- 人間が読みやすい形式が必要な場合。
- **具体例**: ユーザーの設定情報を保存・取得する際にJSON形式を使用します。

#### プロトコルバッファの使用ケース
- gRPC通信でのデータ送受信。
- マイクロサービス間での通信に使用する。
- 高性能かつ効率的なデータ転送が必要な場合。
- バイナリ形式でのデータシリアライズが求められる場合。
- **具体例**: 大量のセンサーデータを効率的に転送する際にプロトコルバッファを使用します。

### セキュリティ対策
- HTTPSを使用して通信を暗号化します。
- JWT（JSON Web Token）を使用して認証と認可を行います。
- CSRF（クロスサイトリクエストフォージェリ）対策を実装します。
- 入力データのバリデーションとサニタイズを行います。
- 定期的なセキュリティレビューとペネトレーションテストを実施します。
- セキュリティヘッダー（例：Content Security Policy, X-Content-Type-Options）を設定します。
- セキュアなコーディングプラクティスを遵守します。
- **具体例**: フォーム入力データをサニタイズし、SQLインジェクション攻撃を防ぎます。

フロントエンドからバックエンドへのリクエストは、適切な認証と認可を経て処理されます。バックエンドは、各種サービスやデータベースと連携し、必要なデータをフロントエンドに返します。

```mermaid
sequenceDiagram
    participant Flutter as フロントエンド (Flutter)
    participant Golang as バックエンド (Golang)
    participant DB as データベース

    Flutter->>Golang: HTTP/3, WebSocket, gRPC リクエスト
    Golang->>DB: データベースクエリ
    DB-->>Golang: クエリ結果
    Golang-->>Flutter: レスポンスデータ
