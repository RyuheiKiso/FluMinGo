# 操作ログテーブル設計書

## 概要

ユーザーの操作（ログイン、更新、削除等）を記録するテーブルです。

## テーブル種類
- トランザクション系

## テーブル定義

- テーブル名: `operation_log`

| カラム名         | データ型      | 制約                                      | 説明                                               |
|------------------|---------------|-------------------------------------------|----------------------------------------------------|
| id               | INT           | PRIMARY KEY, AUTO_INCREMENT               | 操作ログの一意な識別子                              |
| user_id          | INT           | NOT NULL                                  | 操作を実行したユーザーの識別子。`user`テーブルの `id`への参照 |
| operation_type   | VARCHAR(50)   | NOT NULL                                  | 操作の種類（例: login, update, delete等）          |
| operation_detail | TEXT          | DEFAULT NULL                              | 操作詳細、エラーメッセージ等                        |
| ip_address       | VARCHAR(45)   | DEFAULT NULL                              | 操作者のIPアドレス（IPv4/IPv6対応）                |
| created_at       | DATETIME      | NOT NULL, DEFAULT CURRENT_TIMESTAMP        | レコード作成日時                                  |
| updated_at       | DATETIME      | NOT NULL, DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | レコード更新日時            |

## 備考

- `user_id`は`user`テーブルの主キーを参照する外部キーとして設定してください.
- 操作ログについて、IPアドレスの正規化や監査ログとの連携、及びエラー時の詳細な記録を推奨します.
-- ALTER TABLE operation_log ADD CONSTRAINT fk_user FOREIGN KEY (user_id) REFERENCES user(id);
-- CREATE INDEX idx_operation_user ON operation_log(user_id);
- 適切なデータ整合性チェックを実装してください.
- ログは監査・トラブルシュート目的で利用します。保管期間やアーカイブポリシーの策定を検討してください.
- 外部キー制約とインデックス（例: CREATE INDEX idx_operation_user ON operation_log(user_id);）を有効にすることを推奨します.

## 解決策
- 外部キーおよびインデックスの導入により、ログデータの整合性と検索効率を向上させる。
- 定期的なログのローテーションとアーカイブポリシーを策定する。

## 固定値一覧
- operation_type: login, update, delete など

## 関係テーブル
- `user`: 操作を実行したユーザー情報を参照します。

## サンプルデータ

| id | user_id | operation_type | operation_detail      | ip_address      | created_at           | updated_at           |
|----|---------|----------------|-----------------------|-----------------|----------------------|----------------------|
| 1  | 10      | login          | ユーザーログイン成功  | 192.168.1.100   | 2023-10-01 00:00:00  | 2023-10-01 00:00:00  |
| 2  | 10      | delete         | レコード削除         | 192.168.1.101   | 2023-11-05 00:00:00  | 2023-11-05 00:00:00  |
| 3  | 11      | update         | プロフィール更新     | 192.168.1.102   | 2023-12-01 00:00:00  | 2023-12-01 00:00:00  |
| 4  | 12      | logout         | ログアウト成功       | 192.168.1.104   | 2023-12-15 00:00:00  | 2023-12-15 00:00:00  |
| 5  | 13      | update         | プロフィール画像更新 | 192.168.1.110   | 2023-12-20 00:00:00  | 2023-12-20 00:00:00  |
| 6  | 14      | login          | ログイン成功         | 192.168.1.115   | 2023-12-25 00:00:00  | 2023-12-25 00:00:00  |
| 7  | 15      | update         | パスワード変更       | 192.168.1.120   | 2024-01-01 00:00:00  | 2024-01-01 00:00:00  |
| 8  | 16      | delete         | アカウント削除       | 192.168.1.125   | 2024-01-05 00:00:00  | 2024-01-05 00:00:00  |
| 9  | 17      | login          | ログイン成功         | 192.168.1.130   | 2024-01-10 00:00:00  | 2024-01-10 00:00:00  |
| 10 | 18      | update         | メールアドレス変更   | 192.168.1.135   | 2024-01-15 00:00:00  | 2024-01-15 00:00:00  |
